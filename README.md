# Yandex Afisha Automated Tests

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Å–∞–π—Ç–∞ [–Ø–Ω–¥–µ–∫—Å.–ê—Ñ–∏—à–∞](https://afisha.yandex.ru) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Playwright –∏ TypeScript.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#–æ–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤](#–∑–∞–ø—É—Å–∫-—Ç–µ—Å—Ç–æ–≤)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–û—Ç—á–µ—Ç—ã](#–æ—Ç—á–µ—Ç—ã)
- [Docker](#docker)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö end-to-end —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ø–Ω–¥–µ–∫—Å.–ê—Ñ–∏—à–∏. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

- –ù–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —Å–∞–π—Ç—É
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–∫–∞–ª–µ–Ω–¥–∞—Ä—å, —Å–ª–∞–π–¥–µ—Ä—ã, –±–∞–Ω–Ω–µ—Ä—ã)
- –°—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–æ–±—ã—Ç–∏–π
- –ë–ª–æ–∫–∏ –ø–æ–¥–±–æ—Ä–æ–∫ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å "–í—ã —Å–º–æ—Ç—Ä–µ–ª–∏"

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ —à–∞–ø–∫–µ —Å–∞–π—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

2. **–ö–∞–ª–µ–Ω–¥–∞—Ä—å**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –≤–ª–µ–≤–æ –∏ –≤–ø—Ä–∞–≤–æ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–∏–º—ã—Ö –¥–Ω–µ–π

3. **–ë–∞–Ω–Ω–µ—Ä—ã –∏ —Å–ª–∞–π–¥–µ—Ä—ã**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –±–∞–Ω–Ω–µ—Ä–æ–≤ –≤–ª–µ–≤–æ –∏ –≤–ø—Ä–∞–≤–æ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤

4. **–ö–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–±—ã—Ç–∏–π**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ (3 –≤ —Ä—è–¥)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫ (–ø–æ—Å—Ç–µ—Ä, –∑–∞–≥–æ–ª–æ–≤–æ–∫, —Ü–µ–Ω–∞, –¥–µ—Ç–∞–ª–∏, —Ä–µ–π—Ç–∏–Ω–≥ –∏ —Ç.–¥.)

5. **–ë–ª–æ–∫ "–¢–æ–ø"**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ (10 —à—Ç—É–∫)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–æ–¥–±–æ—Ä–∫–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫

6. **–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–¥**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–¥–±–æ—Ä–æ–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –ø–æ–¥–±–æ—Ä–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞–∑–≤–∞–Ω–∏—è–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

7. **–ë–ª–æ–∫ "–í—ã —Å–º–æ—Ç—Ä–µ–ª–∏"**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Playwright** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–æ–≤
- **TypeScript** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript
- **Allure** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–∞—Å–∏–≤—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js** 18 –∏–ª–∏ –≤—ã—à–µ
- **npm** –∏–ª–∏ **yarn**
- **Docker** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
- **Allure Commandline** (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤)

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd yandex-afisha-playwright-tests
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä—ã Playwright:
```bash
npx playwright install chromium
```

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
npm test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –≤–∏–¥–∏–º–æ–º —Ä–µ–∂–∏–º–µ (headed)
npm run test:headed

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
npm run test:debug

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ UI —Ä–µ–∂–∏–º–µ Playwright
npm run test:ui
```

### –ó–∞–ø—É—Å–∫ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π Allure –æ—Ç—á–µ—Ç–æ–≤

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ Allure
npm run allure:generate

# –û—Ç–∫—Ä—ã—Ç–∏–µ –æ—Ç—á–µ—Ç–∞ Allure –≤ –±—Ä–∞—É–∑–µ—Ä–µ
npm run allure:open

# –ó–∞–ø—É—Å–∫ Allure —Å–µ—Ä–≤–µ—Ä–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç)
npm run allure:serve

# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Ç–µ—Å—Ç—ã + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è + –æ—Ç–∫—Ä—ã—Ç–∏–µ –æ—Ç—á–µ—Ç–∞
npm run test:allure
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø–æ –∏–º–µ–Ω–∏
npx playwright test tests/main-page.spec.ts -g "–ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
npx playwright test --grep "–ö–∞–ª–µ–Ω–¥–∞—Ä—å"
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
npx playwright test --project=chromium

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
npx playwright test --retries=2

# –ó–∞–ø—É—Å–∫ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–æ—Ä–∫–µ—Ä–æ–≤
npx playwright test --workers=2
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
yandex-afisha-playwright-tests/
‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ test-data.ts        # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ helpers/                # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ testHelpers.ts      # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ pages/                  # Page Object Model
‚îÇ   ‚îî‚îÄ‚îÄ MainPage.ts         # –ö–ª–∞—Å—Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îú‚îÄ‚îÄ tests/                  # –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ main-page.spec.ts   # –¢–µ—Å—Ç—ã –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îú‚îÄ‚îÄ allure-results/         # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Allure (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ allure-report/          # HTML –æ—Ç—á–µ—Ç Allure (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ playwright-report/      # HTML –æ—Ç—á–µ—Ç Playwright (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ test-results/           # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ playwright.config.ts    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Playwright
‚îú‚îÄ‚îÄ tsconfig.json           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript
‚îú‚îÄ‚îÄ package.json            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ docker-compose.yml      # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## üìä –û—Ç—á–µ—Ç—ã

### Playwright HTML –æ—Ç—á–µ—Ç

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è HTML –æ—Ç—á–µ—Ç –≤ –ø–∞–ø–∫–µ `playwright-report/`:

```bash
npx playwright show-report
```

### Allure –æ—Ç—á–µ—Ç

Allure –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–∞—Ö:

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞:**
```bash
npm run allure:generate
```

2. **–û—Ç–∫—Ä—ã—Ç–∏–µ –æ—Ç—á–µ—Ç–∞:**
```bash
npm run allure:open
```

3. **–ó–∞–ø—É—Å–∫ Allure —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
npm run allure:serve
```

–û—Ç—á–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:
- –î–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —Ç–µ—Å—Ç–µ
- –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤
- –í–∏–¥–µ–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É (trace) –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—é –æ—à–∏–±–æ–∫
- –ò—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

## üê≥ Docker

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ Docker

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø—É—Å–∫ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker Compose

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
docker-compose up playwright-tests

# –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º –ª–æ–≥–æ–≤
docker-compose up --build

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose down
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

**Windows:**
```bash
run-docker.bat
```

**Linux/Mac:**
```bash
chmod +x run-docker.sh
./run-docker.sh
```

#### –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t yandex-afisha-tests .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run --rm yandex-afisha-tests
```

### Allure –≤ Docker

Docker Compose —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∞–µ—Ç —Å–µ—Ä–≤–∏—Å Allure –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤:

```bash
# –ó–∞–ø—É—Å–∫ Allure —Å–µ—Ä–≤–∏—Å–∞
docker-compose up allure

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:5050
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Playwright –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`playwright.config.ts`)

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

- **baseURL**: `https://afisha.yandex.ru`
- **timeout**: 25000ms
- **expect timeout**: 10000ms
- **retries**: 2 (–≤ CI), 0 (–ª–æ–∫–∞–ª—å–Ω–æ)
- **workers**: 1
- **viewport**: 1920x1080
- **trace**: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤
- **screenshot**: —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
- **video**: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏

### –†–µ–ø–æ—Ä—Ç–µ—Ä—ã

1. **List** - –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
2. **HTML** - HTML –æ—Ç—á–µ—Ç –≤ `playwright-report/`
3. **Allure** - Allure –æ—Ç—á–µ—Ç –≤ `allure-results/`

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫ –≤ Allure

- Navigation errors - –æ—à–∏–±–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- Element not found - —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
- Timeout errors - –æ—à–∏–±–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `tests/`:
```typescript
import { test } from '@playwright/test';
import MainPage from '../pages/MainPage';

test.describe('–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å', () => {
    test('–ù–æ–≤—ã–π —Ç–µ—Å—Ç', async ({ page }) => {
        const mainPage = new MainPage(page);
        await mainPage.open('moscow');
        // –í–∞—à —Ç–µ—Å—Ç
    });
});
```

2. –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª `tests/main-page.spec.ts`

### Page Object Model

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Page Object Model. –í—Å–µ –ª–æ–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–ª–∞—Å—Å–µ `MainPage`.

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤:**

```typescript
// –í pages/MainPage.ts
public async newMethod(): Promise<void> {
    const element = this.page.locator(this.locators.someLocator);
    await element.click();
}
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ª–æ–∫–∞—Ç–æ—Ä–æ–≤:**

```typescript
// –í pages/MainPage.ts
locators = {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–æ–∫–∞—Ç–æ—Ä—ã
    newLocator: 'data-test-id=new.element',
}
```

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ data-test-id** - –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `data-test-id` –∞—Ç—Ä–∏–±—É—Ç—ã –≤–º–µ—Å—Ç–æ CSS —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
2. **–ò–∑–±–µ–≥–∞–π—Ç–µ –∂–µ—Å—Ç–∫–∏—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `waitFor` –≤–º–µ—Å—Ç–æ `waitForTimeout` –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Page Object Model** - –≤—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ Page –∫–ª–∞—Å—Å–∞—Ö
4. **–ü–∏—à–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è** - –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã —á–µ—Ç–∫–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∏–ø—ã** - TypeScript –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫

### –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

1. **UI —Ä–µ–∂–∏–º Playwright:**
```bash
npm run test:ui
```

2. **Debug —Ä–µ–∂–∏–º:**
```bash
npm run test:debug
```

3. **–ü—Ä–æ—Å–º–æ—Ç—Ä trace:**
```bash
npx playwright show-trace trace.zip
```

4. **–í–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏:**
–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤. –ù–∞–π—Ç–∏ –º–æ–∂–Ω–æ –≤ `test-results/`

## üìù –°–∫—Ä–∏–ø—Ç—ã package.json

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `test` | –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ |
| `test:headed` | –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –≤–∏–¥–∏–º–æ–º —Ä–µ–∂–∏–º–µ |
| `test:debug` | –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ |
| `test:ui` | –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ UI —Ä–µ–∂–∏–º–µ Playwright |
| `allure:generate` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Allure –æ—Ç—á–µ—Ç–∞ |
| `allure:open` | –û—Ç–∫—Ä—ã—Ç–∏–µ Allure –æ—Ç—á–µ—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ |
| `allure:serve` | –ó–∞–ø—É—Å–∫ Allure —Å–µ—Ä–≤–µ—Ä–∞ |
| `test:allure` | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Ç–µ—Å—Ç—ã + –æ—Ç—á–µ—Ç |

## üîç –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ Playwright
npx playwright --help

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ
npx playwright install --help

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–µ–≥–æ–º
npx playwright test --grep @smoke

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
npx playwright test --project=chromium

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–µ—Å—Ç–æ–≤
npx playwright codegen https://afisha.yandex.ru
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –±—Ä–∞—É–∑–µ—Ä–æ–≤

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤
npx playwright install --force chromium
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Allure

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Allure Commandline –≥–ª–æ–±–∞–ª—å–Ω–æ
npm install -g allure-commandline

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ npx
npx allure-commandline generate ./allure-results
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Docker

```bash
# –û—á–∏—Å—Ç–∫–∞ Docker –∫—ç—à–∞
docker system prune -a

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker-compose build --no-cache
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë§ –ê–≤—Ç–æ—Ä

Dmitry Karpenkov
